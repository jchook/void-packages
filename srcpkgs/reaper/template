# Template file for 'reaper'
pkgname=reaper
version=6.29
revision=1
archs="i686 x86_64 aarch64 armv7l"
wrksrc="reaper_linux_${XBPS_TARGET_MACHINE}"
short_desc="Complete digital audio production application for computers"
maintainer="fosslinux <fosslinux@aussies.space>"
license="custom:Propietary"
homepage="https://www.reaper.fm"
distfiles="https://www.reaper.fm/files/${version%.*}.x/reaper${version//.}_linux_${XBPS_TARGET_MACHINE}.tar.xz"
repository=nonfree
nopie=yes

# TODO: Build our own libSwell.so

case "${XBPS_TARGET_MACHINE}" in
	i686) checksum=83968f664769f04861366f0c5e8db8da4e78b7035fe50ed4688557083e10cef6 ;;
	x86_64) checksum=0ceba5e89d98eeccf2e3e43849e3b4b86e8f4ae53e3042c4ee4cbc5b7992a534 ;;
	armv7l) checksum=ef0dd134085b3694b6962c756190d3055aca7898bf517a37b7f1cecca6a87436 ;;
	aarch64) checksum=ebb8938ba6c595b42dc828e73c88caf0aff7695fb3682b160510969a06289cce ;;
esac

do_install() {
	vmkdir usr/libexec
	./install-reaper.sh --install "${DESTDIR}/usr/libexec"
	mv "${DESTDIR}/usr/libexec/REAPER" "${DESTDIR}/usr/libexec/reaper"

	cd REAPER

	vmkdir usr/share/icons/hicolor/256x256/apps
	vinstall Resources/main.png 0644 usr/share/icons/hicolor/256x256/apps \
		cockos-reaper
	vinstall Resources/reamote.png 0644 usr/share/icons/hicolor/256x256/apps \
		cockos-reamote
	for i in cockos-reaper-backup cockos-reaper-document cockos-reaper-theme \
		cockos-reaper-peak cockos-reaper-template cockos-reaper-template2; do
		vinstall "Resources/${i}.png" 0644 usr/share/icons/hicolor/256x256/apps
	done
	vinstall "${FILESDIR}/cockos-reaper.desktop" 0644 usr/share/applications

	vlicense EULA.txt
	for i in Docs/*; do
		vdoc "${i}"
	done

	for i in whatsnew.txt EULA.txt Docs uninstall-reaper.sh; do
		rm -r "${DESTDIR}/usr/libexec/reaper/${i}"
	done
	vmkdir usr/bin
	ln -s ../libexec/reaper/reaper "${DESTDIR}/usr/bin"
}
